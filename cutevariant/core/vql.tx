
Model:
	commands += Command[";"]
;


// Keep orders 
Command:
    SelectCmd|CreateCmd|SetCmd|BedCmd|CopyCmd
;


SelectCmd:
    'SELECT' fields+=FieldIdentifier[","] ('FROM' source=ID ('WHERE' filter=FilterExpression)?)?
;

CreateCmd:
    'CREATE' target=ID 'FROM' source=ID 'WHERE' filter=FilterExpression
;

CopyCmd:
	'CREATE' target=ID 'FROM' source=ID
;

SetCmdFull:
    'CREATE' target=ID '=' expression=SetExpression
;

SetCmd:
	'CREATE' target=ID '=' first=ID op=SetOperator second=ID
;

BedCmd:
	'CREATE' target=ID 'FROM' source=ID 'INTERSECT' path=STRING
;


//################################## Set Operation ###################

SetExpression:
 op=SetOperand (op=SetOperator op=SetOperand)* 
;


SetOperand:
op= ID | ('(' op=SetExpression ')')
;



//################################## Filter Expression ################

FilterExpression:
 op=FilterOperand (op=BoolOperator op=FilterOperand)* 
;


FilterOperand:
op= FilterTerm | ('(' op=FilterExpression ')')
;

FilterTerm:
    field=FieldIdentifier op=MathOperator val=ValueIdentifier
;


//################################## TERMINALS #########################
Comment: /\#.*$/;

FieldId:/[^\d\W](\w*\.)?\w*\b/;
FieldIdentifier: Function|FieldId;
ValueIdentifier: (NUMBER|STRING|BOOL|Tuple);
ARGS: STRING;
Function: func=ID '(' arg=ARGS ')' ('.' extra=ID)?;
BoolOperator: "AND"|"OR";
SetOperator: "+"|"-"|"&"|"^";
MathOperator: />=|<=|!=|=|>|<|!~|~|is|like|has|in/;
Tuple: '(' items+=ValueIdentifier[','] ')';


